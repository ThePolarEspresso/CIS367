<!doctype html>
<html>

<head>
    <script src="https://pixijs.download/release/pixi.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const app = new PIXI.Application({
                width: 640,
                height: 360,
                backgroundColor: 0x1099bb,
            });

            document.body.appendChild(app.view);

            const sprite = PIXI.Sprite.from("plab.jpg");
            sprite.scale.set(0.1); // make plab small
            sprite.x = app.screen.width / 2;
            sprite.y = app.screen.height / 2;

            // summon plab to the stage
            app.stage.addChild(sprite);

            const left = keyboard("ArrowLeft");
            const up = keyboard("ArrowUp");
            const right = keyboard("ArrowRight");
            const down = keyboard("ArrowDown");

            // handle key inputs
            function keyboard(value) {
                const key = {};
                key.value = value;
                key.isDown = false;
                key.isUp = true;
                key.press = undefined;
                key.release = undefined;

                key.downHandler = (event) => {
                    if (event.key === key.value) {
                        if (key.isUp && key.press) key.press();
                        key.isDown = true;
                        key.isUp = false;
                        event.preventDefault();
                    }
                };

                key.upHandler = (event) => {
                    if (event.key === key.value) {
                        if (key.isDown && key.release) key.release();
                        key.isDown = false;
                        key.isUp = true;
                        event.preventDefault();
                    }
                };

                window.addEventListener("keydown", key.downHandler.bind(key), false);
                window.addEventListener("keyup", key.upHandler.bind(key), false);

                return key;
            }

            // make plab speedy
            const speed = 20;

            function update() {
                if (left.isDown && sprite.x > 0)
                    sprite.x -= speed;

                if (up.isDown && sprite.y > 0)
                    sprite.y -= speed;

                if (right.isDown && sprite.x < app.screen.width - sprite.width)
                    sprite.x += speed;

                if (down.isDown && sprite.y < app.screen.height - sprite.height)
                    sprite.y += speed;
            }

            // animate plab
            app.ticker.add(update);
        });
    </script>
</head>

<body>
    <h1>Plab in the Ocean</h1>
</body>

</html>